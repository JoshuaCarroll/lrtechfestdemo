<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8" />

    <title>GeneriCorp Staff Manager v1.0</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <!-- Google Font -->
    <link href="http://fonts.googleapis.com/css?family=Lato:400,300,300italic,400italic,700,700italic" rel="stylesheet" type="text/css"
    />
    <!-- FontAwesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.css" rel="stylesheet" type="text/css"
    />
    <!-- GeneriCorp's CSS -->
    <link href="style.css" rel="stylesheet" type="text/css" />

</head>

<body>

    <header class="site-header">
        <svg version="1.1" id="logo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
        viewBox="0 0 792 612" style="enable-background:new 0 0 792 612;" xml:space="preserve">
            <path class="st0" d="M722.4,240.9c-22-38.7-63-64.8-110-64.8c-70.3,0-127.3,58.2-127.3,129.9s57,129.9,127.3,129.9
    c47,0,88-26.1,110-64.8H792c-26.3,75.6-96.7,129.8-179.8,129.8s-153.5-54.2-179.8-129.8h-60.3c-26.3,75.6-96.7,129.8-179.8,129.8
    C86.9,500.9,1.4,413.6,1.4,306s85.5-194.9,190.9-194.9c83,0,153.5,54.2,179.8,129.8h-69.7c-22-38.7-63-64.8-110-64.8
    c-70.3,0-127.3,58.2-127.3,129.9s57,129.9,127.3,129.9c47,0,88-26.1,110-64.8h-59.2V306h178.2c0-107.6,85.5-194.9,190.9-194.9
    c83,0,153.5,54.2,179.8,129.8H722.4z" />
        </svg>
        <span class="logo-text">GeneriCorp</span>
        <span class="slogan">Dedicated to being legally nondescript…for you</span>
    </header>

    <section class="page">
        <div class="secondary" data-bind="visible: showEmployeeOfTheMonth, with: employeeOfTheMonth">
            <h2 class="employee-of-the-month-heading"><i class="fa fa-fw fa-star"></i> Employee of the month</h2>
            <section class="panel">
                <div class="member member--stack">
                    <img src="https://s3.amazonaws.com/uifaces/faces/twitter/allisongrayce/128.jpg" alt="" class="member__pic" data-bind="attr: { src: picUrl }" />
                    <span class="member__name" data-bind="text: name"></span>
                </div>
            </section>
        </div>
        <div class="main">
            <section class="panel">
                <h1>Staff <a class="heading-action add-staff-member" href="" data-bind="click: toggleShowAddStaffMember"><i class="fa fa-plus-circle"></i> <span>Add a staff member</span></a></h1>

                <div class="staff">
                    <div class="member member--is-editing member--was-just-added" data-bind="visible: showAddStaffMember, with: newStaffMember">
                        <img class="member__pic" src="https://s3.amazonaws.com/uifaces/faces/twitter/robertovivancos/128.jpg" alt="" data-bind="attr: { src: picUrl }">
                        <div class="member__info">
                            <input type="text" data-bind="textInput: name" class="member__name" onmouseup="return false;" />
                            <input type="text" data-bind="textInput: email" class="member__email" onmouseup="return false;" />
                        </div>
                        <div class="member__actions">
                            <button class="member__action star" title="Makes this person employee of the month."><i class="fa fa-fw fa-star"></i></button>
                            <button class="member__action edit"><i class="fa fa-fw fa-edit"></i></button>
                            <button class="member__action save" data-bind="click: $root.addStaffMember"><i class="fa fa-fw fa-check-circle"></i></button>
                            <button class="member__action delete"><i class="fa fa-fw fa-trash"></i></button>
                        </div>
                    </div>

                    <div data-bind="foreach: staffMembers">
                        <div class="member">
                            <img class="member__pic" src="https://s3.amazonaws.com/uifaces/faces/twitter/allisongrayce/128.jpg" alt="" data-bind="attr: { src: picUrl }"
                            />
                            <div class="member__info">
                                <span class="member__name" data-bind="inlineEdit: name"></span>
                                <span class="member__email" data-bind="inlineEdit: email"></span>
                            </div>
                            <div class="member__actions">
                                <button class="member__action star" title="Makes this person employee of the month." data-bind="click: $root.toggleEmployeeOfTheMonth"><i class="fa fa-fw fa-star" data-bind="css: { 'star--is-filled': employeeOfTheMonth() }"></i></button>
                                <button class="member__action edit"><i class="fa fa-fw fa-edit"></i></button>
                                <button class="member__action save"><i class="fa fa-fw fa-check-circle"></i></button>
                                <button class="member__action delete" data-bind="click: $parent.removeStaffMember"><i class="fa fa-fw fa-trash"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <div data-bind="dump: staffViewModel"></div>
    </section>

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-min.js"></script>
    <script src="bindings.js"></script>
    <script>
        var staffMember = (function(memberData){
          var name = ko.observable('Full name…');
          var email = ko.observable('Email address…');
          var picUrl = ko.observable('');
          var employeeOfTheMonth = ko.observable(false);
            
          if(memberData){
              name(ko.unwrap(memberData.name));
              email(ko.unwrap(memberData.email));
              picUrl(ko.unwrap(memberData.picUrl));
          }else{
               $.get("http://uifaces.com/api/v1/random", function(data){
                    picUrl(data.image_urls.epic); 
                });
          }
          
          return {
              name: name,
              email: email,
              picUrl: picUrl,
              employeeOfTheMonth: employeeOfTheMonth
          }  
        });
        
        var staffViewModel = (function(){
            var staffMembers = ko.observableArray([]);
            var newStaffMember = ko.observable(staffMember());
            var showAddStaffMember = ko.observable(false);
            var showEmployeeOfTheMonth = ko.observable(false);
            var toggleShowAddStaffMember = function(){
              if(showAddStaffMember()){
                  showAddStaffMember(false);
              }else{
                  showAddStaffMember(true);
              }  
            };
            
            var employeeOfTheMonth = ko.computed(function(){
                var eotm;
                ko.utils.arrayForEach(staffMembers(), function(member){
                    if(member.employeeOfTheMonth()){
                        showEmployeeOfTheMonth(true);
                        eotm = member;
                    }
                });
                if(eotm === undefined){
                    eotm = staffMember();
                    showEmployeeOfTheMonth(false);
                }
                return eotm;
            });
            
            var addStaffMember = function(){
              staffMembers.push(newStaffMember());
              showAddStaffMember(false);
              newStaffMember(staffMember());  
            };
            
            var removeStaffMember = function(memberToRemove){
                staffMembers.remove(memberToRemove);
            };
            
            var toggleEmployeeOfTheMonth = function(memberToMakeEmployeeOfTheMonth){
                ko.utils.arrayForEach(staffMembers(), function(member){
                    if(member === memberToMakeEmployeeOfTheMonth){
                        if(member.employeeOfTheMonth()){
                            memberToMakeEmployeeOfTheMonth.employeeOfTheMonth(false);
                        }else{
                            memberToMakeEmployeeOfTheMonth.employeeOfTheMonth(true);
                        }
                    }else{
                        member.employeeOfTheMonth(false);
                    }
                });
            };
            
            return {
                staffMembers: staffMembers,
                newStaffMember: newStaffMember,
                addStaffMember: addStaffMember,
                removeStaffMember: removeStaffMember,
                showAddStaffMember: showAddStaffMember,
                toggleShowAddStaffMember: toggleShowAddStaffMember,
                showEmployeeOfTheMonth: showEmployeeOfTheMonth,
                toggleEmployeeOfTheMonth: toggleEmployeeOfTheMonth,
                employeeOfTheMonth: employeeOfTheMonth
            }
        })();
        $(function(){
            ko.applyBindings(staffViewModel);
            $(document).on("focus", ".member__info input", function(e){
                $(this).select();
            });
        });
    </script>
    <!--
        $(function(){
                $('.staff').on('click', '.edit', function(e){
                    e.preventDefault();
                    $('.member__name,.member__email').attr('contenteditable','true');
                    $('.member--is-editing').removeClass('member--is-editing');
                    $(this).parents('.member').addClass('member--is-editing');
                    $(this).parents('.member').find('.member__name').focus();
                });
                $('.staff').on('click', '.save', function(e){
                    e.preventDefault();
                    $(this).parents('.member').removeClass('member--is-editing');
                    $('.member__name,.member__email').attr('contenteditable','false');
                    if($(this).parents('.member').hasClass('member--was-just-added')) {
                        $(this).parents('.member').removeClass('member--was-just-added');
                    }
                });
                $('.staff').on('click', '.delete', function(e){
                    e.preventDefault();
                    var deleteButton = $(this);
                    $(this).parents('.member').addClass('member--is-being-deleted');
                    setTimeout(function(){
                        deleteButton.parents('.member').remove();
                    }, 250);
                });
                $('.member__name,.member__email').on('blur', function(){
                    var memberName = $(this).parents('.member').find('.member__name');
                    var memberEmail = $(this).parents('.member').find('.member__email');
                    if(memberName.text() == '') {
                        alert('Please enter a name...');
                        memberName.focus();
                    }
                    if(memberEmail.text() == '') {
                        alert('Please enter an email...');
                        memberEmail.focus();
                    }
                });
                $('.staff').on('dblclick', '.member__name,.member__email', function(e){
                    e.preventDefault();
                    $('.member--is-editing').removeClass('member--is-editing');
                    $(this).parents('.member').addClass('member--is-editing');
                    $(this).focus();
                    $(this).attr('contenteditable','true');
                });
                $('.staff').on('click', '.star', function(e){
                    e.preventDefault();
                    $('.star').removeClass('star--is-filled');
                    $(this).addClass('star--is-filled');
                });
                $('.add-staff-member').on('click', function(e){
                    e.preventDefault();
                    if( !$('.member--was-just-added').length ){
                        $('.staff').prepend('<div class="member member--is-editing member--was-just-added"> <img class="member__pic" src="https://s3.amazonaws.com/uifaces/faces/twitter/robertovivancos/128.jpg" alt=""> <div class="member__info"> <span class="member__name" contenteditable="">Full name&hellip;</span> <span class="member__email" contenteditable="">Email address&hellip;</span> </div><div class="member__actions"> <button class="member__action star" title="Makes this person employee of the month."><i class="fa fa-fw fa-star"></i></button> <button class="member__action edit"><i class="fa fa-fw fa-edit"></i></button> <button class="member__action save"><i class="fa fa-fw fa-check-circle"></i></button> <button class="member__action delete"><i class="fa fa-fw fa-trash"></i></button> </div></div>');
                    }
                    $('.member--was-just-added').find('.member__name').focus();
                    
                });
                -->
</body>

</html>